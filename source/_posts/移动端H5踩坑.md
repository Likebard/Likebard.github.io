---
title: 移动端H5踩坑
date: 2021-08-14 17:49:58
categories: 面试
tags: ["八股", "h5"]
---
### 移动端的300ms点击延迟及点击穿透现象  
这是由于历史原因造成的，一般解决手段为禁止混用 touch 和 click，或者增加一层“透明”蒙层，也可以通过延迟上层元素消失来实现。还可以引入fastclick库

### 点击元素禁止产生背景或边框
``` css
-webkit-tap-highlight-color: rgba(0,0,0,0); 
```
### 禁止长按链接与图片弹出菜单
``` css
-webkit-touch-callout: none;
```

### 禁止用户选中文字
``` css
-webkit-user-select:none; 
user-select: none;
```

### 取消 input 输入时，英文首字母的默认大写
``` html
<input autocapitalize="off" autocorrect="off" />
```

### fixed在ios下定位问题：  
比如软键盘弹出时，某些情况下，会影响 fixed 元素定位；配合使用 transform、translate 时，某些情况下，也会影响 fixed 元素定位。一般解决方案是模拟 fixed 定位，或者使用 iScroll 库。

### 怎么让 Chrome 支持小于 12px 的文字？
``` css
-webkit-text-size-adjust:none;
```

### iOS 下 webview 中，局部滚动很卡  
Android 下直接正常设置 CSS overflow: auto（或 scroll）即可，但 iOS 下滚动起来依旧不流畅，且手指移开屏幕后，滚动立刻停止，没有全局滚动时的惯性滚动效果。iOS 上还需要增加一个私有的 CSS 属性，以达到流畅滚动。所以，想让局部滚动流畅，需给滚动元素上添加如下的 CSS：
``` css
overflow: auto;
-webkit-overflow-scrolling: touch; /* iOS 需要 */
```

### 粘性定位  
所谓粘性定位问题是：某块内容起初在页面的中部，但随着页面的滚动，到达顶端时，吸附在顶部，不继续滚动。解决此问题更好的方案是使用 CSS3 中新增的定位属性 position: sticky，专门用于解决此类问题。但测试下来发现，iOS 下支持的很好（网上说 iOS 6 开始支持），但 Android 下，低版本的 webview 不支持，所以需要做兼容处理，
``` js
// 给待粘性定位的元素添加如下样式：
position: -webkit-sticky;
position: sticky;

// 同时提供特性检测代码，检查是否支持粘性布局：
function isSupportSticky() {
  var prefixList = ['', '-webkit-'];
  var stickyText = '';
  for (var i = 0; i < prefixList.length; i++) {
      stickyText += 'position:' + prefixList[i] + 'sticky;';
  }
  var div = document.createElement('div');
  div.style.cssText = 'display:none;' + stickyText;
  document.body.appendChild(div);
  var isSupport = /sticky/i.test(window.getComputedStyle(div).position);
  document.body.removeChild(div);
  div = null;
  return isSupport;
}

// 针对不支持的场景，注册滚动事件处理
element.addEventListener('scroll', callback);
```

### babel-polyfill 对 Promise 的封装有 bug  
解决方案是用 bluebird 替换 babel-polyfill 中的 Promise 实现。bluebird 号称是性能最好的 Promise 实现，甚至比原生的实现性能还要好（对此说法有疑惑，持保留态度）。

### css动画页面闪白，动画卡顿  
解决方法:  
1.尽可能地使用合成属性transform和opacity来设计CSS3动画，不使用position的left和top来定位  
2.开启硬件加速  
``` css
-webkit-transform: translate3d(0, 0, 0);
-moz-transform: translate3d(0, 0, 0);
-ms-transform: translate3d(0, 0, 0);
transform: translate3d(0, 0, 0);
```

### 如何解决移动端 Retina 屏 1px 像素问题
rem + viewport

操作步骤如下。在根元素html设置font-size. 将元素转换成rem

通过 window.devicePixelRatio 拿到dpr 再写meta 设置 viewport的scale : 1/dpr